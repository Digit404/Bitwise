<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrōmle</title>
    <link rel="shortcut icon" href="/res/favicon.png" type="image/png">
    <link href="https://unpkg.com/sanitize.css" rel="stylesheet" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap&family=Matemasie');

        body {
            margin: 0;
            padding: 0;
            font-family: 'Fira Code', monospace;
            background-color: #000;
            color: #fff;
            justify-content: center;
        }

        #main-title {
            position: absolute;
            font-size: 10em;
            top: 20%;
            margin: 0;
            padding: 20px 50px;
            border-radius: 20px;
            background: #1118;
            backdrop-filter: invert(1);
            font-family: "Matemasie";
            transition: scale 3s ease-in-out, transform 3s ease-in-out;
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1;
            display: none;
        }

        #bg-left {
            position: fixed;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            background-color: #000;
            z-index: -1;
            transition: background-color 1s linear;
        }

        #bg-right {
            position: fixed;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            background-color: #000;
            z-index: -1;
            transition: background-color 1s linear;
        }

        .countdown {
            position: absolute;
            font-size: 5em;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: "Permanent Marker";
            opacity: 0;
            animation: slap-in 800ms forwards;
            z-index: 2;
        }

        .button {
            font-size: 3em;
            padding: 20px 30px;
            border: none;
            border-radius: 20px;
            background: #111a;
            backdrop-filter: invert(1);
            color: #fff;
            cursor: pointer;
            font-family: monospace;
            transition: 0.3s;
        }

        .button:hover {
            background: #aaaa;
        }

        .button:active {
            background: #fff;
            color: #111;
        }

        #play-button {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translate(-50%, -50%);
            backdrop-filter: invert(1);
        }

        #guess-button {
            margin-top: 50px;
        }

        .guess-box {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 5rem;
            padding: 20px 30px;
            border: none;
            border-radius: 20px;
            background: #111a;
            backdrop-filter: invert(1);
            font-family: "monospace";
            color: #fff;
        }

        #guess-input {
            font-size: 5rem;
            overflow: hidden;
            border: none;
            border-radius: 20px;
            background: #0000;
            font-family: "monospace";
            align-items: baseline;
            color: #fff;
            cursor: pointer;
            resize: none;
            text-transform: uppercase;
        }

        #guess-input:focus {
            outline: none;
        }

        .invalid {
            background: #f11a;
        }

        #diff-display {
            font-size: 3rem;
            position: absolute;
            top: 20%;
        }

        label {
            font-size: 2rem;
            color: #fff;
            backdrop-filter: invert(1);
            background-color: #111a;
            position: absolute;
            top: 90%;
            padding: 5px 10px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        /* Hide the default checkbox */
        input[type="checkbox"] {
            display: none;
        }

        /* Custom checkbox design */
        .custom-checkbox {
            width: 24px;
            height: 24px;
            background-color: #444;
            border: 2px solid #fff;
            border-radius: 4px;
            display: inline-block;
            position: relative;
            margin-right: 10px;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }

        input[type="checkbox"]:not(:checked) + .custom-checkbox::before {
            content: '';
            position: absolute;
            top: 6px;
            left: 6px;
            width: 12px;
            height: 12px;
            background-color: transparent;
            border: 2px solid transparent;
            border-radius: 2px;
            transition: background-color 0.3s, border-color 0.3s;
        }

        input[type="checkbox"]:checked + .custom-checkbox {
            background-color: #ff9800;
            border-color: #ff9800;
        }

        input[type="checkbox"]:checked + .custom-checkbox::before {
            background-color: #fff;
            border-color: #ff9800;
        }


        @keyframes slap-in {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(4);
            }

            10% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            90% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1);
            }
        }
    </style>
</head>

<body>
    <div id="bg-left"></div>
    <div id="bg-right"></div>
    <div class="screen" id="start-screen" style="display: flex;">
        <h1 id="main-title">Chrōmle</h1>
        <button class="button" id="play-button">Start</button>
        <label for="easy-mode">
            <input type="checkbox" id="easy-mode">
            <span class="custom-checkbox"></span>
            Easy Mode
        </label>
    </div>
    <div class="screen" id="game-screen">
        <span class="guess-box">#<textarea id="guess-input" rows="1" cols="6" maxlength="6"></textarea></span>
        <button class="button" id="guess-button">Guess</button>

        <div id="diff-display" hidden>R: G: B: </div>
    </div>
    <script>
        const title = document.getElementById('main-title');
        const bgLeft = document.getElementById('bg-left');
        const bgRight = document.getElementById('bg-right');
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const guessButton = document.getElementById('guess-button');
        const diffDisplay = document.getElementById('diff-display');
        const guessInput = document.getElementById('guess-input');

        bgLeft.style.transition = 'background-color 3s linear';
        bgRight.style.transition = 'background-color 3s linear';

        function flashBackground() {
            bgLeft.style.backgroundColor = getRandomColor();
            bgRight.style.backgroundColor = getRandomColor();
            title.style.scale = Math.random() * 0.5 + 1;
            title.style.transform = `rotate(${Math.random() * 10 - 5}deg)`;
        }

        const startScene = setInterval(flashBackground, 3000);

        setTimeout(() => {
            flashBackground();
        }, 0);

        function getRandomColor() {
            const hex = Math.floor(Math.random() * 16777216).toString(16).padStart(6, '0');
            return '#' + hex;
        }

        function getRandomHalfColor() {
            const hex = Math.floor(Math.random() * 4096).toString(16).padStart(3, '0');
            const doubledHex = hex.split('').map(char => char + char).join('');
            return '#' + doubledHex;
        }

        function colorCodeToValue (color) {
            const hex = color.replace('#', '');
            if (hex.length === 3) {
                return {
                    r: parseInt(hex[0] + hex[0], 16),
                    g: parseInt(hex[1] + hex[1], 16),
                    b: parseInt(hex[2] + hex[2], 16)
                };
            } else {
                return {
                    r: parseInt(hex.slice(0, 2), 16),
                    g: parseInt(hex.slice(2, 4), 16),
                    b: parseInt(hex.slice(4, 6), 16)
                };
            }
        }

        function colorValueToCode (color) {
            return `#${color.r.toString(16).padStart(2, '0')}${color.g.toString(16).padStart(2, '0')}${color.b.toString(16).padStart(2, '0')}`;
        }

        document.querySelector('#play-button').addEventListener('click', () => {
            bgLeft.style.transition = 'background-color 1s linear';
            bgRight.style.transition = 'background-color 1s linear';
            clearInterval(startScene);
            bgLeft.style.backgroundColor = '#000';
            bgRight.style.backgroundColor = '#000';
            startScreen.style.display = 'none';
            let i = 3;
            const countdown = () => {
                if (i > 0) {
                    let number = document.createElement('div');
                    number.textContent = i;
                    number.classList.add('countdown');
                    document.body.appendChild(number);
                    setTimeout(() => {
                        number.remove();
                        i--;
                        countdown();
                    }, 800); // not actually a second
                } else {
                    let go = document.createElement('div');
                    go.textContent = 'Go!';
                    go.classList.add('countdown');
                    document.body.appendChild(go);
                    setTimeout(() => {
                        go.remove();
                    }, 800);
                    startGame();
                }
            };
            countdown();
        });

        function startGame() {
            const easyMode = document.getElementById('easy-mode').checked;

            let color = '';

            if (easyMode) {
                color = getRandomHalfColor();
                guessInput.maxLength = 3;
                guessInput.cols = 3;
            } else {
                color = getRandomColor();
            }

            const colorValue = colorCodeToValue(color);

            bgRight.style.backgroundColor = color;

            gameScreen.style.display = 'flex';

            guessButton.addEventListener('click', () => {
                const guess = guessInput.value;

                // check if the guess is a valid hex color
                if (!/^[0-9A-F]{3}([0-9A-F]{3})?$/i.test(guess)) {
                    guessButton.textContent = 'Invalid';
                    guessButton.classList.add('invalid');
                    setTimeout(() => {
                        guessButton.textContent = 'Guess';
                        guessButton.classList.remove('invalid');
                    }, 1000);
                    return;
                }

                const guessValue = colorCodeToValue(`#${guess}`);

                const diff = {
                    r: colorValue.r - guessValue.r,
                    g: colorValue.g - guessValue.g,
                    b: colorValue.b - guessValue.b
                };

                const diffValue = {
                    r: diff.r > 0 ? '⬆' : diff.r < 0 ? '⬇' : '🟩',
                    g: diff.g > 0 ? '⬆' : diff.g < 0 ? '⬇' : '🟩',
                    b: diff.b > 0 ? '⬆' : diff.b < 0 ? '⬇️' : '🟩'
                }

                diffDisplay.textContent = `${diffValue.r} ${diffValue.g} ${diffValue.b}`;

                diffDisplay.hidden = false;
                
                bgLeft.style.backgroundColor = `#${guess}`;
            });
        }
    </script>
</body>

</html>